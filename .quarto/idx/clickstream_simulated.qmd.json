{"title":"Understanding User Journeys with Clickstream Analysis","markdown":{"yaml":{"title":"Understanding User Journeys with Clickstream Analysis","subtitle":"From Raw Events to UX Insight Using Markov Chains","author":"Stephen Pierzchajlo","date":"today","format":{"html":{"theme":"cosmo","toc":true,"toc-depth":2,"code-fold":true}},"execute":{"warning":false,"message":false},"tags":["UX","Clickstream Analysis","Markov Chains","User Research"]},"headingText":"Environment Setup","containsRefs":false,"markdown":"\n\nClickstream data reveals **how users navigate a product over time**, not just what pages they visit or whether they convert. Unlike traditional metrics, sequence-aware analysis shows **how early interactions shape later behavior**, helping UX teams design experiences that guide users toward their goals.\n\nIn this project, I simulate clickstream data and apply **Markov chains** with **flow-based visualizations** to answer three core UX questions:\n\n1. How do users actually move through the product?\n2. Which interactions most strongly predict conversion?\n3. Where do users abandon — and in how many different ways?\n\n> **Note:** This project uses **simulated clickstream data** to demonstrate methodology. The goal is to show **how UX teams can reason about user journeys**, not to optimize a specific product funnel.\n\nTo ensure reproducibility, I use a standard analytics stack in R for data manipulation, visualization, and Markov modeling.\n\n### Load libraries and ensure reproducibility\n```{r}\n# Ensure results are reproducible\nset.seed(123)\n\n# Core data manipulation and visualization\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(tibble)\nlibrary(ggplot2)\nlibrary(forcats)\n\n# Modeling and visualization\nlibrary(markovchain)\nlibrary(ggalluvial)\nlibrary(plotly)\nlibrary(purrr)\n```\n\n\n## Simulating Clickstream Sessions\n\nReal clickstream data is often proprietary, so I simulate **realistic session paths.**\n\nEach session:\n\n- Begins with a page view\n- Moves through product exploration and checkout steps\n- Ends in either purchase or abandonment\n\nThis simplified structure mirrors typical e-commerce behavior and lets us **focus on methodology and insight.**\n```{r}\n# Number of simulated sessions\nn_sessions <- 500\n\n# Possible interaction events\nevents <- c(\"page_view\", \"product_view\", \"add_to_cart\", \"checkout\", \"logout\")\n\n# Initialize empty dataset\ndf <- data.frame(SessionID = integer(),\n                 UserID = integer(),\n                 EventType = character(),\n                 Outcome = character(),\n                 stringsAsFactors = FALSE)\n\n# Simulate session-level user journeys\nfor (sid in 1:n_sessions) {\n  \n  # Random session length\n  n_events <- sample(3:6, 1)\n  path <- character(n_events)\n  \n  # All sessions start with a page view\n  path[1] <- \"page_view\"\n  \n  # Simulate navigation behavior\n  for (i in 2:n_events) {\n    prev <- path[i - 1]\n    if (prev == \"page_view\") {\n      path[i] <- sample(c(\"product_view\", \"logout\"), 1, prob = c(0.7, 0.3))\n    } else if (prev == \"product_view\") {\n      path[i] <- sample(c(\"add_to_cart\", \"logout\"), 1, prob = c(0.6, 0.4))\n    } else if (prev == \"add_to_cart\") {\n      path[i] <- sample(c(\"checkout\", \"logout\"), 1, prob = c(0.7, 0.3))\n    } else if (prev == \"checkout\") {\n      path[i] <- sample(c(\"purchase\", \"no_purchase\"), 1, prob = c(0.6, 0.4))\n    } else if (prev == \"logout\") {\n      path[i] <- \"no_purchase\"\n    }\n  }\n  \n  # Define session outcome based on final state\n  outcome <- ifelse(path[n_events] == \"purchase\", \"purchase\", \"no_purchase\")\n  \n  # Append session to dataset\n  df <- rbind(df, data.frame(SessionID = sid,\n                             UserID = sid,\n                             EventType = path,\n                             Outcome = outcome,\n                             stringsAsFactors = FALSE))\n}\n```\n\n## Transforming Events into Transitions\n\nRaw logs show **what happened**, but not **how events relate to one another.**\n\nBy converting logs into **state-to-state transitions**, we can analyze navigation probabilistically. The final outcomes (purchase or no_purchase) are treated as **absorbing states**.\n```{r}\n# Build transitions table\ntransitions <- df %>%\n  group_by(SessionID) %>%\n  mutate(next_event = lead(EventType)) %>%\n  ungroup() %>%\n  mutate(next_event = ifelse(is.na(next_event), Outcome, next_event))\n```\n\n## Modeling User Behavior with Markov Chains\n\nTraditional funnels assume a **fixed sequence** of steps. Markov chains allow users to:\n\n- Branch\n- Loop\n- Abandon at any point\n\n**UX perspective**: We can ask, “Given a user’s current interaction, what is the probability they eventually convert?”\n\n```{r}\n# Fit Markov chain using MLE\nmc <- markovchainFit(data = transitions[, c(\"EventType\", \"next_event\")], method = \"mle\")$estimate\n```\n\n## Measuring Conversion Likelihood\nBy making purchase and no_purchase absorbing, we can compute the **probability that each interaction eventually leads to purchase.**\n```{r}\n# Define absorbing states\ntm <- mc@transitionMatrix\n\n# Purchase is absorbing\ntm[\"purchase\", ] <- 0\ntm[\"purchase\", \"purchase\"] <- 1\n\n# No purchase is absorbing\ntm[\"no_purchase\", ] <- 0\ntm[\"no_purchase\", \"no_purchase\"] <- 1\n\nmc_abs <- new(\"markovchain\", states = mc@states, transitionMatrix = tm)\n\n# Compute absorption probabilities\nabs_probs <- absorptionProbabilities(mc_abs)\n\n# Absorption rate dataframe\nabs_probs_df <- as.data.frame(abs_probs) %>%\n  rownames_to_column(\"Event\") %>%\n  pivot_longer(-Event, names_to = \"Outcome\", values_to = \"Probability\")\n\n# Remove first two rows\nabs_probs_df <- abs_probs_df[-c(1, 2), ]\n```\n\n### Visualize expected outcomes by interaction\n```{r}\n# Plot probability of purchase by event\nggplot(abs_probs_df %>%\n         mutate(Event = fct_reorder(Event, Probability, .fun = max)), aes(x = Event, y = Probability, fill = Outcome)) +\n  geom_col() +\n  coord_flip() +\n  labs(title = \"Probability of Ending in Purchase or No Purchase by Event\",\n       x = \"Event\",\n       y = \"Probability\") +\n  scale_fill_manual(values = c(\"purchase\" = \"steelblue\", \"no_purchase\" = \"tomato\")) +\n  theme_minimal()\n```\n**UX Insight:**\n\n-Later-stage interactions like checkout strongly predict purchase\n-Intermediate actions such as add_to_cart sharply increase conversion likelihood\n-Sequence-aware modeling reveals **key leverage points** that static funnels can miss\n\n## Ranking Interactions by Influence\n```{r}\n# Rank funnel interactions by their likelihood of leading to purchase\nabs_probs_df %>%\n  filter(Outcome == \"purchase\") %>%\n  arrange(desc(Probability))\n```\n**UX takeaway:** Focus design and A/B testing on **high-impact steps**, like adding items to the cart or early product views.\n\n## Visualizing Drop-Offs and User Flow\n\nAlluvial diagrams show **branching behavior**, revealing:\n\n- Dominant navigation paths\n- Where users exit\n- How many ways abandonment occurs\n```{r fig.width=10, dpi=100}\n# Create explicit event-to-event transitions\ndf_flow <- df %>%\n  group_by(SessionID) %>%\n  mutate(next_event = lead(EventType)) %>%\n  ungroup() %>%\n  mutate(next_event = ifelse(is.na(next_event), Outcome, next_event)) %>%\n  filter(!is.na(next_event), next_event != \"\")\n\n# Aggregate transitions\nflow_counts <- df_flow %>%\n  group_by(EventType, next_event) %>%\n  summarise(Freq = n(), .groups = \"drop\") %>%\n  filter(EventType != next_event)\n\n# Collapse terminal states into \"End\" and mark outcome\nflow_counts_clean <- flow_counts %>% mutate(EventType = ifelse(EventType %in% c(\"purchase\", \"no_purchase\"), \"End\", EventType),\n                                           next_event_label = next_event,\n                                           next_event = ifelse(next_event %in% c(\"purchase\", \"no_purchase\"), \"End\", next_event),\n                                           flow_type = case_when(next_event_label == \"purchase\" ~ \"Purchase\",\n                                                                 next_event_label == \"no_purchase\" ~ \"Abandon\",\n                                                                 TRUE ~ \"Intermediate\")) %>%\n  group_by(EventType, next_event, flow_type) %>%\n  summarise(Freq = sum(Freq), .groups = \"drop\")\n\n# Remove first row\nflow_counts_clean <- flow_counts_clean[-c(1, 1), ]\n\n# Define colors for flow types\nflow_colors <- c(\"Purchase\" = \"#2ca02c\",\n                 \"Abandon\" = \"#d62728\",\n                 \"Intermediate\" = \"#1f77b4\")\n\n# Plot the alluvial diagram\nggplot(flow_counts_clean, aes(axis1 = EventType, axis2 = next_event, y = Freq)) +\n  geom_alluvium(aes(fill = flow_type), width = 1/12) +\n  geom_stratum(width = 1/12, fill = \"grey80\", color = \"black\") +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  scale_x_discrete(limits = c(\"Current Event\", \"Next Event\")) +\n  scale_fill_manual(values = flow_colors) +\n  labs(title = \"User Flow Through Funnel Steps\",\n       subtitle = \"Green = purchase, Red = abandonment, Blue = intermediate steps\",\n       y = \"Number of Users\",\n       fill = \"Flow Type\") +\n  theme_minimal(base_size = 14)\n```\n**UX Insight:**\n\n- Abandonment occurs across multiple paths, not just at a single step\n- Linear funnels oversimplify real behavior; interventions must consider **context and branching**\n\n## Purchase Journey Analysis\nWe examine the journey from three perspectives: **magnitude**, **direction**, and **structure.**\n\n## Funnel: Step Completion\n```{r}\n# Define the ordered funnel steps from entry to conversion\nfunnel_steps <- c(\"page_view\",\n                  \"product_view\",\n                  \"add_to_cart\",\n                  \"checkout\",\n                  \"purchase\")\n\n# Determine the furthest funnel step reached by each session\nsession_funnel <- df %>%\n  filter(EventType %in% funnel_steps) %>%\n  group_by(SessionID) %>%\n  summarise(step = max(match(EventType, funnel_steps)), .groups = \"drop\")\n\n# Count number of sessions that reached each step or beyond\nfunnel_counts <- data.frame(step = funnel_steps,\n                            value = sapply(seq_along(funnel_steps), function(i)\n                              sum(session_funnel$step >= i)))\n\n# Visualize the funnel as a Plotly funnel chart\nplot_ly(funnel_counts,\n        type = \"funnel\",\n        y = ~step,\n        x = ~value)\n```\n**Takeaways:**\n\n- Major drop occurs **before add_to_cart**\n- Users who reach checkout are likely to purchase\n- Early exits drive overall funnel losses\n\n\n## Sankey: Step-to-Step Movement\n```{r}\n# Create step-to-step transitions across all sessions\ntransitions <- df %>%\n  filter(!is.na(EventType), EventType != \"\") %>%\n  group_by(SessionID) %>%\n  mutate(next_event = lead(EventType)) %>%\n  ungroup() %>%\n  filter(!is.na(next_event)) %>%\n  count(EventType, next_event, name = \"value\")\n\n# Define unique nodes for the Sankey diagram (each funnel step)\nnodes <- data.frame(name = unique(c(transitions$EventType, transitions$next_event)))\n\n# Assign numeric IDs required by Plotly Sankey format\nnodes$id <- seq_len(nrow(nodes)) - 1\n\n# Map transition counts to source and target node IDs\nlinks <- transitions %>%\n  left_join(nodes, by = c(\"EventType\" = \"name\")) %>%\n  rename(source = id) %>%\n  left_join(nodes, by = c(\"next_event\" = \"name\")) %>%\n  rename(target = id)\n\n# Normalize transition values so outgoing flows sum to 1 per source step\nlinks <- links %>%\n  group_by(source) %>%\n  mutate(value = value / sum(value)) %>%\n  ungroup()\n\n# Visualize directional user movement through the funnel as a Sankey diagram\nplot_ly(type = \"sankey\", node = list(label = nodes$name),\n        link = list(source = links$source,\n                    target = links$target,\n                    value = links$value))\n```\n**Insight:**\n\n- Early exits (logout) dominate drop-offs\n- Few users move backward\n- Successful purchases follow **narrow, consistent paths**\n\n## Sunburst: Complete Session Paths\n```{r}\n# Build full session-level paths and final outcomes (one row per session)\npaths <- df %>%\n  filter(!is.na(EventType), EventType != \"\") %>%\n  group_by(SessionID) %>%\n  summarise(event_path = paste(EventType, collapse = \"/\"), outcome = last(Outcome), .groups = \"drop\")\n\n# Remove any terminal purchase/no_purchase from the raw path\npaths <- paths %>%\n  mutate(event_path = gsub(\"/?(purchase|no_purchase)$\", \"\", event_path))\n\n# Append outcome to create complete paths ending in purchase or no_purchase\npaths <- paths %>%\n  mutate(full_path = paste(event_path, outcome, sep = \"/\"))\n\n# Count how many users followed each unique full path\npath_counts <- paths %>%\n  count(full_path, name = \"value\")\n\n# Generate all hierarchical parent paths needed for a sunburst diagram\nall_paths <- unique(unlist(lapply(strsplit(path_counts$full_path, \"/\"), function(x)\n    sapply(seq_along(x), function(i)\n      paste(x[1:i], collapse = \"/\")))))\n\n# Assemble hierarchical data structure required by Plotly sunburst\nsunburst_data <- data.frame(path = all_paths) %>%\n  left_join(path_counts, by = c(\"path\" = \"full_path\")) %>%\n  mutate(value = ifelse(is.na(value), 0, value), ids = path,\n         labels = sub(\".*/\", \"\", path),\n         parents = ifelse(grepl(\"/\", path), sub(\"/[^/]+$\", \"\", path),\"\"))\n\n# Flag terminal outcome nodes for custom coloring\nsunburst_data <- sunburst_data %>%\n  mutate(is_outcome = labels %in% c(\"purchase\", \"no_purchase\"))\n\n# Visualize complete user journeys as a sunburst diagram\nplot_ly(sunburst_data,\n        type = \"sunburst\",\n        ids = ~ids,\n        labels = ~labels,\n        parents = ~parents,\n        values = ~value,\n        marker = list(colors = ifelse(sunburst_data$is_outcome, ifelse(sunburst_data$labels == \"purchase\", \"#2ca02c\", \"#d62728\"), \"#1f77b4\")))\n```\n**Insight:**\n\n- Dominant path: page_view → product_view → add_to_cart → checkout → purchase\n- Alternative paths mostly terminate in no_purchase\n- Conversion depends on staying on a **narrow “golden path”**\n\n**UX Implications**\n\nBy treating events as **connected sequences**, we can:\n\n- Identify **high-impact interactions** driving conversion\n- Understand **where and how users abandon**\n- Prioritize design and experimentation **based on evidence**\n\nSequence-aware analysis provides **better insight than static funnels**, while complementing qualitative research to answer **where and why UX issues occur.**\n\n**Bottom line:** Behavior-aware analytics leads to **smarter UX decisions** and more effective product interventions.","srcMarkdownNoYaml":"\n\nClickstream data reveals **how users navigate a product over time**, not just what pages they visit or whether they convert. Unlike traditional metrics, sequence-aware analysis shows **how early interactions shape later behavior**, helping UX teams design experiences that guide users toward their goals.\n\nIn this project, I simulate clickstream data and apply **Markov chains** with **flow-based visualizations** to answer three core UX questions:\n\n1. How do users actually move through the product?\n2. Which interactions most strongly predict conversion?\n3. Where do users abandon — and in how many different ways?\n\n> **Note:** This project uses **simulated clickstream data** to demonstrate methodology. The goal is to show **how UX teams can reason about user journeys**, not to optimize a specific product funnel.\n\n## Environment Setup\nTo ensure reproducibility, I use a standard analytics stack in R for data manipulation, visualization, and Markov modeling.\n\n### Load libraries and ensure reproducibility\n```{r}\n# Ensure results are reproducible\nset.seed(123)\n\n# Core data manipulation and visualization\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(tibble)\nlibrary(ggplot2)\nlibrary(forcats)\n\n# Modeling and visualization\nlibrary(markovchain)\nlibrary(ggalluvial)\nlibrary(plotly)\nlibrary(purrr)\n```\n\n\n## Simulating Clickstream Sessions\n\nReal clickstream data is often proprietary, so I simulate **realistic session paths.**\n\nEach session:\n\n- Begins with a page view\n- Moves through product exploration and checkout steps\n- Ends in either purchase or abandonment\n\nThis simplified structure mirrors typical e-commerce behavior and lets us **focus on methodology and insight.**\n```{r}\n# Number of simulated sessions\nn_sessions <- 500\n\n# Possible interaction events\nevents <- c(\"page_view\", \"product_view\", \"add_to_cart\", \"checkout\", \"logout\")\n\n# Initialize empty dataset\ndf <- data.frame(SessionID = integer(),\n                 UserID = integer(),\n                 EventType = character(),\n                 Outcome = character(),\n                 stringsAsFactors = FALSE)\n\n# Simulate session-level user journeys\nfor (sid in 1:n_sessions) {\n  \n  # Random session length\n  n_events <- sample(3:6, 1)\n  path <- character(n_events)\n  \n  # All sessions start with a page view\n  path[1] <- \"page_view\"\n  \n  # Simulate navigation behavior\n  for (i in 2:n_events) {\n    prev <- path[i - 1]\n    if (prev == \"page_view\") {\n      path[i] <- sample(c(\"product_view\", \"logout\"), 1, prob = c(0.7, 0.3))\n    } else if (prev == \"product_view\") {\n      path[i] <- sample(c(\"add_to_cart\", \"logout\"), 1, prob = c(0.6, 0.4))\n    } else if (prev == \"add_to_cart\") {\n      path[i] <- sample(c(\"checkout\", \"logout\"), 1, prob = c(0.7, 0.3))\n    } else if (prev == \"checkout\") {\n      path[i] <- sample(c(\"purchase\", \"no_purchase\"), 1, prob = c(0.6, 0.4))\n    } else if (prev == \"logout\") {\n      path[i] <- \"no_purchase\"\n    }\n  }\n  \n  # Define session outcome based on final state\n  outcome <- ifelse(path[n_events] == \"purchase\", \"purchase\", \"no_purchase\")\n  \n  # Append session to dataset\n  df <- rbind(df, data.frame(SessionID = sid,\n                             UserID = sid,\n                             EventType = path,\n                             Outcome = outcome,\n                             stringsAsFactors = FALSE))\n}\n```\n\n## Transforming Events into Transitions\n\nRaw logs show **what happened**, but not **how events relate to one another.**\n\nBy converting logs into **state-to-state transitions**, we can analyze navigation probabilistically. The final outcomes (purchase or no_purchase) are treated as **absorbing states**.\n```{r}\n# Build transitions table\ntransitions <- df %>%\n  group_by(SessionID) %>%\n  mutate(next_event = lead(EventType)) %>%\n  ungroup() %>%\n  mutate(next_event = ifelse(is.na(next_event), Outcome, next_event))\n```\n\n## Modeling User Behavior with Markov Chains\n\nTraditional funnels assume a **fixed sequence** of steps. Markov chains allow users to:\n\n- Branch\n- Loop\n- Abandon at any point\n\n**UX perspective**: We can ask, “Given a user’s current interaction, what is the probability they eventually convert?”\n\n```{r}\n# Fit Markov chain using MLE\nmc <- markovchainFit(data = transitions[, c(\"EventType\", \"next_event\")], method = \"mle\")$estimate\n```\n\n## Measuring Conversion Likelihood\nBy making purchase and no_purchase absorbing, we can compute the **probability that each interaction eventually leads to purchase.**\n```{r}\n# Define absorbing states\ntm <- mc@transitionMatrix\n\n# Purchase is absorbing\ntm[\"purchase\", ] <- 0\ntm[\"purchase\", \"purchase\"] <- 1\n\n# No purchase is absorbing\ntm[\"no_purchase\", ] <- 0\ntm[\"no_purchase\", \"no_purchase\"] <- 1\n\nmc_abs <- new(\"markovchain\", states = mc@states, transitionMatrix = tm)\n\n# Compute absorption probabilities\nabs_probs <- absorptionProbabilities(mc_abs)\n\n# Absorption rate dataframe\nabs_probs_df <- as.data.frame(abs_probs) %>%\n  rownames_to_column(\"Event\") %>%\n  pivot_longer(-Event, names_to = \"Outcome\", values_to = \"Probability\")\n\n# Remove first two rows\nabs_probs_df <- abs_probs_df[-c(1, 2), ]\n```\n\n### Visualize expected outcomes by interaction\n```{r}\n# Plot probability of purchase by event\nggplot(abs_probs_df %>%\n         mutate(Event = fct_reorder(Event, Probability, .fun = max)), aes(x = Event, y = Probability, fill = Outcome)) +\n  geom_col() +\n  coord_flip() +\n  labs(title = \"Probability of Ending in Purchase or No Purchase by Event\",\n       x = \"Event\",\n       y = \"Probability\") +\n  scale_fill_manual(values = c(\"purchase\" = \"steelblue\", \"no_purchase\" = \"tomato\")) +\n  theme_minimal()\n```\n**UX Insight:**\n\n-Later-stage interactions like checkout strongly predict purchase\n-Intermediate actions such as add_to_cart sharply increase conversion likelihood\n-Sequence-aware modeling reveals **key leverage points** that static funnels can miss\n\n## Ranking Interactions by Influence\n```{r}\n# Rank funnel interactions by their likelihood of leading to purchase\nabs_probs_df %>%\n  filter(Outcome == \"purchase\") %>%\n  arrange(desc(Probability))\n```\n**UX takeaway:** Focus design and A/B testing on **high-impact steps**, like adding items to the cart or early product views.\n\n## Visualizing Drop-Offs and User Flow\n\nAlluvial diagrams show **branching behavior**, revealing:\n\n- Dominant navigation paths\n- Where users exit\n- How many ways abandonment occurs\n```{r fig.width=10, dpi=100}\n# Create explicit event-to-event transitions\ndf_flow <- df %>%\n  group_by(SessionID) %>%\n  mutate(next_event = lead(EventType)) %>%\n  ungroup() %>%\n  mutate(next_event = ifelse(is.na(next_event), Outcome, next_event)) %>%\n  filter(!is.na(next_event), next_event != \"\")\n\n# Aggregate transitions\nflow_counts <- df_flow %>%\n  group_by(EventType, next_event) %>%\n  summarise(Freq = n(), .groups = \"drop\") %>%\n  filter(EventType != next_event)\n\n# Collapse terminal states into \"End\" and mark outcome\nflow_counts_clean <- flow_counts %>% mutate(EventType = ifelse(EventType %in% c(\"purchase\", \"no_purchase\"), \"End\", EventType),\n                                           next_event_label = next_event,\n                                           next_event = ifelse(next_event %in% c(\"purchase\", \"no_purchase\"), \"End\", next_event),\n                                           flow_type = case_when(next_event_label == \"purchase\" ~ \"Purchase\",\n                                                                 next_event_label == \"no_purchase\" ~ \"Abandon\",\n                                                                 TRUE ~ \"Intermediate\")) %>%\n  group_by(EventType, next_event, flow_type) %>%\n  summarise(Freq = sum(Freq), .groups = \"drop\")\n\n# Remove first row\nflow_counts_clean <- flow_counts_clean[-c(1, 1), ]\n\n# Define colors for flow types\nflow_colors <- c(\"Purchase\" = \"#2ca02c\",\n                 \"Abandon\" = \"#d62728\",\n                 \"Intermediate\" = \"#1f77b4\")\n\n# Plot the alluvial diagram\nggplot(flow_counts_clean, aes(axis1 = EventType, axis2 = next_event, y = Freq)) +\n  geom_alluvium(aes(fill = flow_type), width = 1/12) +\n  geom_stratum(width = 1/12, fill = \"grey80\", color = \"black\") +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  scale_x_discrete(limits = c(\"Current Event\", \"Next Event\")) +\n  scale_fill_manual(values = flow_colors) +\n  labs(title = \"User Flow Through Funnel Steps\",\n       subtitle = \"Green = purchase, Red = abandonment, Blue = intermediate steps\",\n       y = \"Number of Users\",\n       fill = \"Flow Type\") +\n  theme_minimal(base_size = 14)\n```\n**UX Insight:**\n\n- Abandonment occurs across multiple paths, not just at a single step\n- Linear funnels oversimplify real behavior; interventions must consider **context and branching**\n\n## Purchase Journey Analysis\nWe examine the journey from three perspectives: **magnitude**, **direction**, and **structure.**\n\n## Funnel: Step Completion\n```{r}\n# Define the ordered funnel steps from entry to conversion\nfunnel_steps <- c(\"page_view\",\n                  \"product_view\",\n                  \"add_to_cart\",\n                  \"checkout\",\n                  \"purchase\")\n\n# Determine the furthest funnel step reached by each session\nsession_funnel <- df %>%\n  filter(EventType %in% funnel_steps) %>%\n  group_by(SessionID) %>%\n  summarise(step = max(match(EventType, funnel_steps)), .groups = \"drop\")\n\n# Count number of sessions that reached each step or beyond\nfunnel_counts <- data.frame(step = funnel_steps,\n                            value = sapply(seq_along(funnel_steps), function(i)\n                              sum(session_funnel$step >= i)))\n\n# Visualize the funnel as a Plotly funnel chart\nplot_ly(funnel_counts,\n        type = \"funnel\",\n        y = ~step,\n        x = ~value)\n```\n**Takeaways:**\n\n- Major drop occurs **before add_to_cart**\n- Users who reach checkout are likely to purchase\n- Early exits drive overall funnel losses\n\n\n## Sankey: Step-to-Step Movement\n```{r}\n# Create step-to-step transitions across all sessions\ntransitions <- df %>%\n  filter(!is.na(EventType), EventType != \"\") %>%\n  group_by(SessionID) %>%\n  mutate(next_event = lead(EventType)) %>%\n  ungroup() %>%\n  filter(!is.na(next_event)) %>%\n  count(EventType, next_event, name = \"value\")\n\n# Define unique nodes for the Sankey diagram (each funnel step)\nnodes <- data.frame(name = unique(c(transitions$EventType, transitions$next_event)))\n\n# Assign numeric IDs required by Plotly Sankey format\nnodes$id <- seq_len(nrow(nodes)) - 1\n\n# Map transition counts to source and target node IDs\nlinks <- transitions %>%\n  left_join(nodes, by = c(\"EventType\" = \"name\")) %>%\n  rename(source = id) %>%\n  left_join(nodes, by = c(\"next_event\" = \"name\")) %>%\n  rename(target = id)\n\n# Normalize transition values so outgoing flows sum to 1 per source step\nlinks <- links %>%\n  group_by(source) %>%\n  mutate(value = value / sum(value)) %>%\n  ungroup()\n\n# Visualize directional user movement through the funnel as a Sankey diagram\nplot_ly(type = \"sankey\", node = list(label = nodes$name),\n        link = list(source = links$source,\n                    target = links$target,\n                    value = links$value))\n```\n**Insight:**\n\n- Early exits (logout) dominate drop-offs\n- Few users move backward\n- Successful purchases follow **narrow, consistent paths**\n\n## Sunburst: Complete Session Paths\n```{r}\n# Build full session-level paths and final outcomes (one row per session)\npaths <- df %>%\n  filter(!is.na(EventType), EventType != \"\") %>%\n  group_by(SessionID) %>%\n  summarise(event_path = paste(EventType, collapse = \"/\"), outcome = last(Outcome), .groups = \"drop\")\n\n# Remove any terminal purchase/no_purchase from the raw path\npaths <- paths %>%\n  mutate(event_path = gsub(\"/?(purchase|no_purchase)$\", \"\", event_path))\n\n# Append outcome to create complete paths ending in purchase or no_purchase\npaths <- paths %>%\n  mutate(full_path = paste(event_path, outcome, sep = \"/\"))\n\n# Count how many users followed each unique full path\npath_counts <- paths %>%\n  count(full_path, name = \"value\")\n\n# Generate all hierarchical parent paths needed for a sunburst diagram\nall_paths <- unique(unlist(lapply(strsplit(path_counts$full_path, \"/\"), function(x)\n    sapply(seq_along(x), function(i)\n      paste(x[1:i], collapse = \"/\")))))\n\n# Assemble hierarchical data structure required by Plotly sunburst\nsunburst_data <- data.frame(path = all_paths) %>%\n  left_join(path_counts, by = c(\"path\" = \"full_path\")) %>%\n  mutate(value = ifelse(is.na(value), 0, value), ids = path,\n         labels = sub(\".*/\", \"\", path),\n         parents = ifelse(grepl(\"/\", path), sub(\"/[^/]+$\", \"\", path),\"\"))\n\n# Flag terminal outcome nodes for custom coloring\nsunburst_data <- sunburst_data %>%\n  mutate(is_outcome = labels %in% c(\"purchase\", \"no_purchase\"))\n\n# Visualize complete user journeys as a sunburst diagram\nplot_ly(sunburst_data,\n        type = \"sunburst\",\n        ids = ~ids,\n        labels = ~labels,\n        parents = ~parents,\n        values = ~value,\n        marker = list(colors = ifelse(sunburst_data$is_outcome, ifelse(sunburst_data$labels == \"purchase\", \"#2ca02c\", \"#d62728\"), \"#1f77b4\")))\n```\n**Insight:**\n\n- Dominant path: page_view → product_view → add_to_cart → checkout → purchase\n- Alternative paths mostly terminate in no_purchase\n- Conversion depends on staying on a **narrow “golden path”**\n\n**UX Implications**\n\nBy treating events as **connected sequences**, we can:\n\n- Identify **high-impact interactions** driving conversion\n- Understand **where and how users abandon**\n- Prioritize design and experimentation **based on evidence**\n\nSequence-aware analysis provides **better insight than static funnels**, while complementing qualitative research to answer **where and why UX issues occur.**\n\n**Bottom line:** Behavior-aware analytics leads to **smarter UX decisions** and more effective product interventions."},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":2,"output-file":"clickstream_simulated.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","theme":"cosmo","title":"Understanding User Journeys with Clickstream Analysis","subtitle":"From Raw Events to UX Insight Using Markov Chains","author":"Stephen Pierzchajlo","date":"today","tags":["UX","Clickstream Analysis","Markov Chains","User Research"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}